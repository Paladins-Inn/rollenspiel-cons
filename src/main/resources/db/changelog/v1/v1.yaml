databaseChangeLog:
  - changeSet:
      id: 001-create-schema-cons
      author: klenkes74
      changes:
        - sql:
            create schema if not exists cons;
  
  - changeSet:
      id: 010-create-persons
      author: klenkes74
      changes:
        - createTable:
            schemaName: cons
            tableName: PERSONS
            columns:
              - column:
                  name: id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: version
                  type: integer
                  constraints:
                    nullable: false
              - column:
                  name: OWNER
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: NAME
                  type: varchar(250)
                  constraints:
                    nullable: false
              - column:
                  name: URI
                  type: varchar(250)
                  constraints:
                    nullable: true
              - column:
                  name: PERSON_TYPE
                  type: varchar(15)
                  constraints:
                    nullable: true
  
  - changeSet:
      id: 020-create-weblocations
      author: klenkes74
      changes:
        - createTable:
            schemaName: cons
            tableName: WEBLOCATIONS
            columns:
              - column:
                  name: id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: version
                  type: integer
                  constraints:
                    nullable: false
              - column:
                  name: OWNER
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: NAME
                  type: varchar(250)
                  constraints:
                    nullable: false
              - column:
                  name: URI
                  type: varchar(250)
                  constraints:
                    nullable: true
              - column:
                  name: WEBSITE_OF_EVENT_ID
                  type: bigint
                  constraints:
                    nullable: true
  
  - changeSet:
      id: 030-create-physicaladdresses
      author: klenkes74
      changes:
        - createTable:
            schemaName: cons
            tableName: PHYSICALADDRESSES
            columns:
              - column:
                  name: id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: version
                  type: integer
                  constraints:
                    nullable: false
              - column:
                  name: OWNER
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: NAME
                  type: varchar(250)
                  constraints:
                    nullable: false
              - column:
                  name: URI
                  type: varchar(250)
                  constraints:
                    nullable: true
              - column:
                  name: ADDRESS
                  type: varchar(250)
                  constraints:
                    nullable: false
              - column:
                  name: THREE_WORDS
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: LONGITUDE
                  type: double precision
                  constraints:
                    nullable: false
              - column:
                  name: LATITUDE
                  type: double precision
                  constraints:
                    nullable: false
              - column:
                  name: EVENT_ID
                  type: bigint
                  constraints:
                    nullable: true
  
  - changeSet:
      id: 040-create-events
      author: klenkes74
      changes:
        - createTable:
            schemaName: cons
            tableName: EVENTS
            columns:
              - column:
                  name: id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: version
                  type: integer
                  constraints:
                    nullable: false
              - column:
                  name: OWNER
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: NAME
                  type: varchar(250)
                  constraints:
                    nullable: false
              - column:
                  name: URI
                  type: varchar(250)
                  constraints:
                    nullable: true
              - column:
                  name: TEMPORAL_START
                  type: timestamptz
                  constraints:
                    nullable: true
              - column:
                  name: TEMPORAL_END
                  type: timestamptz
                  constraints:
                    nullable: true
              - column:
                  name: EXTERNAL_ID
                  type: varchar(100)
                  constraints:
                    nullable: true
              - column:
                  name: WEBSITE_ID
                  type: bigint
                  constraints:
                    nullable: true
              - column:
                  name: DESCRIPTION
                  type: text
                  constraints:
                    nullable: false
  
  - changeSet:
      id: 050-create-event-labels
      author: klenkes74
      changes:
        - createTable:
            schemaName: cons
            tableName: EVENT_LABELS
            columns:
              - column:
                  name: EVENT_ID
                  type: bigint
                  constraints:
                    nullable: false
              - column:
                  name: LABEL
                  type: varchar(255)
                  constraints:
                    nullable: false
        - addPrimaryKey:
            schemaName: cons
            tableName: EVENT_LABELS
            columnNames: EVENT_ID, LABEL
            constraintName: pk_event_labels
  
  - changeSet:
      id: 060-create-calendars
      author: klenkes74
      changes:
        - createTable:
            schemaName: cons
            tableName: CALENDARS
            columns:
              - column:
                  name: id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: version
                  type: integer
                  constraints:
                    nullable: false
              - column:
                  name: OWNER
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: NAME
                  type: varchar(250)
                  constraints:
                    nullable: false
              - column:
                  name: URI
                  type: varchar(250)
                  constraints:
                    nullable: true
              - column:
                  name: CALENDAR_TYPE
                  type: varchar(20)
                  constraints:
                    nullable: true
              - column:
                  name: CALENDAR_ID
                  type: varchar(400)
                  constraints:
                    nullable: false
              - column:
                  name: SYNC_PERIOD
                  type: interval
                  constraints:
                    nullable: false
              - column:
                  name: LAST_SYNC_TIME
                  type: timestamptz
                  constraints:
                    nullable: true
              - column:
                  name: LAST_SYNC_ATTEMPT_TIME
                  type: timestamptz
                  constraints:
                    nullable: true
              - column:
                  name: LAST_SYNC_RESULT
                  type: varchar(50)
                  constraints:
                    nullable: false
        - loadUpdateData:
            schemaName: cons
            tableName: CALENDARS
            primaryKey: id
            file: initial-calendars.csv
            relativeToChangelogFile: true
            separator: ','
            encoding: UTF-8
            columns:
              - column:
                  name: id
                  type: bigint
              - column:
                  name: sync_period
                  type: interval
              - column:
                  name: last_sync_attempt_time
                  type: timestamp with time zone
              - column:
                  name: last_sync_result
                  type: varchar(50)
              - column:
                  name: last_sync_time
                  type: timestamp with time zone
  
  - changeSet:
      id: 070-add-foreign-keys
      author: klenkes74
      changes:
        - addForeignKeyConstraint:
            baseTableSchemaName: cons
            baseTableName: PHYSICALADDRESSES
            baseColumnNames: EVENT_ID
            referencedTableSchemaName: cons
            referencedTableName: EVENTS
            referencedColumnNames: id
            constraintName: fk_physicaladdresses_event
        - addForeignKeyConstraint:
            baseTableSchemaName: cons
            baseTableName: WEBLOCATIONS
            baseColumnNames: WEBSITE_OF_EVENT_ID
            referencedTableSchemaName: cons
            referencedTableName: EVENTS
            referencedColumnNames: id
            constraintName: fk_weblocations_event
        - addForeignKeyConstraint:
            baseTableSchemaName: cons
            baseTableName: EVENTS
            baseColumnNames: WEBSITE_ID
            referencedTableSchemaName: cons
            referencedTableName: WEBLOCATIONS
            referencedColumnNames: id
            constraintName: fk_events_website

