<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/de/paladinsinn/rollenspielcons/config/RestClientConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/de/paladinsinn/rollenspielcons/config/RestClientConfig.java" />
              <option name="originalContent" value="package de.paladinsinn.rollenspielcons.config;&#10;&#10;&#10;import de.paladinsinn.rollenspielcons.services.geo.GeocodeMapsCoClient;&#10;import jakarta.validation.constraints.NotNull;&#10;import java.util.Map;&#10;import lombok.RequiredArgsConstructor;&#10;import lombok.extern.slf4j.Slf4j;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.http.client.JdkClientHttpRequestFactory;&#10;import org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager;&#10;import org.springframework.security.oauth2.client.web.client.OAuth2ClientHttpRequestInterceptor;&#10;import org.springframework.web.client.RestClient;&#10;import org.springframework.web.client.support.RestClientAdapter;&#10;import org.springframework.web.service.invoker.HttpServiceProxyFactory;&#10;import org.springframework.web.util.DefaultUriBuilderFactory;&#10;import org.springframework.web.util.UriBuilderFactory;&#10;&#10;&#10;/**&#10; * Creates a REST client for the Geocode Maps Co service.&#10; *&#10; * @author klenkes74 {@literal &lt;rlichti@kaiserpfalz-edv.de&gt;}&#10; * @since 2025-10-12&#10; */&#10;@Configuration&#10;@RequiredArgsConstructor&#10;@Slf4j&#10;public class RestClientConfig {&#10;  &#10;  @Bean&#10;  public RestClient restClient(@NotNull final RestClient.Builder builder) {&#10;    log.trace(&quot;enter - &quot;);&#10;    &#10;    var result = builder.build();&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;&#10;  @Bean&#10;  public GeocodeMapsCoClient geocodeMapsCoClient(&#10;      @NotNull @Value(&quot;${geocoding.api.url&quot;) final String url,&#10;      @NotNull RestClient.Builder clientBuilder,&#10;      @NotNull JdkClientHttpRequestFactory requestFactory,&#10;      @NotNull UriBuilderFactory apiKeyInjectorFactory,&#10;      @NotNull OAuth2ClientHttpRequestInterceptor oauth2Interceptor&#10;  ) {&#10;    log.trace(&quot;enter - {}, {}, {}, {}&quot;, url, clientBuilder, requestFactory, oauth2Interceptor);&#10;    &#10;    var restClient = restClient(&#10;        url,&#10;        clientBuilder,&#10;        requestFactory,&#10;        apiKeyInjectorFactory,&#10;        oauth2Interceptor&#10;    );&#10;&#10;    GeocodeMapsCoClient result = HttpServiceProxyFactory.builder()&#10;        .exchangeAdapter(RestClientAdapter.create(restClient))&#10;        .build()&#10;        .createClient(GeocodeMapsCoClient.class);&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result.getClass());&#10;    &#10;    return result;&#10;  }&#10;  &#10;  private RestClient restClient(&#10;      @NotNull final String url,&#10;      @NotNull RestClient.Builder clientBuilder,&#10;      @NotNull JdkClientHttpRequestFactory requestFactory,&#10;      @NotNull UriBuilderFactory apiKeyInjectorFactory,&#10;      @NotNull OAuth2ClientHttpRequestInterceptor oauth2Interceptor&#10;  ) {&#10;    log.trace(&quot;enter - {}, {}, {}, {}, {}&quot;, url, clientBuilder, requestFactory, apiKeyInjectorFactory, oauth2Interceptor);&#10;    &#10;    var result = clientBuilder&#10;        .requestFactory(requestFactory)&#10;        .uriBuilderFactory(apiKeyInjectorFactory)&#10;        .baseUrl(url)&#10;        .requestInterceptor(oauth2Interceptor)&#10;        .build();&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;  &#10;  @Bean&#10;  public JdkClientHttpRequestFactory jdkClientHttpRequestFactory() {&#10;    log.trace(&quot;enter - &quot;);&#10;    &#10;    JdkClientHttpRequestFactory result = new JdkClientHttpRequestFactory();&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;  &#10;  @Bean&#10;  public UriBuilderFactory uriBuilderFactory(&#10;      @Value(&quot;${geocoding.api.key:changeme}&quot;) final String apiKey&#10;  ) {&#10;    log.trace(&quot;enter - {}&quot;, apiKey);&#10;    &#10;    var result = new DefaultUriBuilderFactory();&#10;    result.setDefaultUriVariables(Map.of(&quot;api_key&quot;, apiKey));&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;  &#10;  &#10;  @Bean&#10;  public OAuth2ClientHttpRequestInterceptor oauth2HttpRequestInterceptor(&#10;      @NotNull OAuth2AuthorizedClientManager oauth2Manager&#10;  ) {&#10;    log.trace(&quot;enter - {}&quot;, oauth2Manager);&#10;    &#10;    OAuth2ClientHttpRequestInterceptor result = new OAuth2ClientHttpRequestInterceptor(oauth2Manager);&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;}&#10;" />
              <option name="updatedContent" value="package de.paladinsinn.rollenspielcons.config;&#10;&#10;&#10;import de.paladinsinn.rollenspielcons.services.geo.GeocodeMapsCoClient;&#10;import jakarta.validation.constraints.NotNull;&#10;import java.util.Map;&#10;import lombok.RequiredArgsConstructor;&#10;import lombok.extern.slf4j.Slf4j;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.http.client.JdkClientHttpRequestFactory;&#10;import org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager;&#10;import org.springframework.security.oauth2.client.web.client.OAuth2ClientHttpRequestInterceptor;&#10;import org.springframework.web.client.RestClient;&#10;import org.springframework.web.client.support.RestClientAdapter;&#10;import org.springframework.web.service.invoker.HttpServiceProxyFactory;&#10;import org.springframework.web.util.DefaultUriBuilderFactory;&#10;import org.springframework.web.util.UriBuilderFactory;&#10;&#10;&#10;/**&#10; * Creates a REST client for the Geocode Maps Co service.&#10; *&#10; * @author klenkes74 {@literal &lt;rlichti@kaiserpfalz-edv.de&gt;}&#10; * @since 2025-10-12&#10; */&#10;@Configuration&#10;@RequiredArgsConstructor&#10;@Slf4j&#10;public class RestClientConfig {&#10;  &#10;  @Bean&#10;  public RestClient restClient(@NotNull @org.springframework.context.annotation.Lazy final RestClient.Builder builder) {&#10;    log.trace(&quot;enter - &quot;);&#10;    &#10;    var result = builder.build();&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;&#10;  @Bean&#10;  public GeocodeMapsCoClient geocodeMapsCoClient(&#10;      @NotNull @Value(&quot;${geocoding.api.url&quot;) final String url,&#10;      @NotNull @org.springframework.context.annotation.Lazy RestClient.Builder clientBuilder,&#10;      @NotNull JdkClientHttpRequestFactory requestFactory,&#10;      @NotNull UriBuilderFactory apiKeyInjectorFactory,&#10;      @NotNull OAuth2ClientHttpRequestInterceptor oauth2Interceptor&#10;  ) {&#10;    log.trace(&quot;enter - {}, {}, {}, {}&quot;, url, clientBuilder, requestFactory, oauth2Interceptor);&#10;    &#10;    var restClient = restClient(&#10;        url,&#10;        clientBuilder,&#10;        requestFactory,&#10;        apiKeyInjectorFactory,&#10;        oauth2Interceptor&#10;    );&#10;&#10;    GeocodeMapsCoClient result = HttpServiceProxyFactory.builder()&#10;        .exchangeAdapter(RestClientAdapter.create(restClient))&#10;        .build()&#10;        .createClient(GeocodeMapsCoClient.class);&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result.getClass());&#10;    &#10;    return result;&#10;  }&#10;  &#10;  private RestClient restClient(&#10;      @NotNull final String url,&#10;      @NotNull RestClient.Builder clientBuilder,&#10;      @NotNull JdkClientHttpRequestFactory requestFactory,&#10;      @NotNull UriBuilderFactory apiKeyInjectorFactory,&#10;      @NotNull OAuth2ClientHttpRequestInterceptor oauth2Interceptor&#10;  ) {&#10;    log.trace(&quot;enter - {}, {}, {}, {}, {}&quot;, url, clientBuilder, requestFactory, apiKeyInjectorFactory, oauth2Interceptor);&#10;    &#10;    var result = clientBuilder&#10;        .requestFactory(requestFactory)&#10;        .uriBuilderFactory(apiKeyInjectorFactory)&#10;        .baseUrl(url)&#10;        .requestInterceptor(oauth2Interceptor)&#10;        .build();&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;  &#10;  @Bean&#10;  public JdkClientHttpRequestFactory jdkClientHttpRequestFactory() {&#10;    log.trace(&quot;enter - &quot;);&#10;    &#10;    JdkClientHttpRequestFactory result = new JdkClientHttpRequestFactory();&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;  &#10;  @Bean&#10;  public UriBuilderFactory uriBuilderFactory(&#10;      @Value(&quot;${geocoding.api.key:changeme}&quot;) final String apiKey&#10;  ) {&#10;    log.trace(&quot;enter - {}&quot;, apiKey);&#10;    &#10;    var result = new DefaultUriBuilderFactory();&#10;    result.setDefaultUriVariables(Map.of(&quot;api_key&quot;, apiKey));&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;  &#10;  &#10;  @Bean&#10;  public OAuth2ClientHttpRequestInterceptor oauth2HttpRequestInterceptor(&#10;      @NotNull OAuth2AuthorizedClientManager oauth2Manager&#10;  ) {&#10;    log.trace(&quot;enter - {}&quot;, oauth2Manager);&#10;    &#10;    OAuth2ClientHttpRequestInterceptor result = new OAuth2ClientHttpRequestInterceptor(oauth2Manager);&#10;    &#10;    log.trace(&quot;exit - {}&quot;, result);&#10;    return result;&#10;  }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>